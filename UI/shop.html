{% extends "layout.html" %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='shop.css') }}">
<style>
.shop-hero {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 4rem 0;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.shop-hero::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:
    radial-gradient(circle at 25% 25%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(255, 119, 198, 0.3) 0%, transparent 50%);
  animation: float 15s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  33% { transform: translateY(-20px) rotate(1deg); }
  66% { transform: translateY(10px) rotate(-1deg); }
}

.shop-title {
  font-size: 3rem;
  font-weight: 800;
  text-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
  margin-bottom: 1rem;
  background: linear-gradient(135deg, #ffffff 0%, rgba(255, 255, 255, 0.8) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.shop-subtitle {
  font-size: 1.3rem;
  font-weight: 300;
  text-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  margin-bottom: 2rem;
}

.filter-section {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 2rem;
  margin-bottom: 3rem;
  position: relative;
}

.filter-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 1.5rem;
  color: #ffffff;
}

.filter-form {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
  justify-content: center;
}

.filter-select {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  color: #ffffff;
  padding: 0.75rem 1rem;
  font-weight: 500;
  transition: all 0.3s ease;
  min-width: 200px;
}

.filter-select:focus {
  background: rgba(255, 255, 255, 0.08);
  border-color: #667eea;
  box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
  color: #ffffff;
}

.filter-select option {
  background: #0f0f23;
  color: #ffffff;
}

.filter-button {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  padding: 0.75rem 2rem;
  font-weight: 600;
  border-radius: 12px;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.filter-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
}

.products-grid {
  position: relative;
}

.product-card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  overflow: hidden;
  transition: all 0.3s ease;
  height: 100%;
  position: relative;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.product-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.product-card:hover::before {
  opacity: 1;
}

.product-card:hover {
  transform: translateY(-10px);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  border-color: rgba(102, 126, 234, 0.3);
}

.product-image {
  height: 250px;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.product-card:hover .product-image {
  transform: scale(1.05);
}

.product-title {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #ffffff;
}

.product-description {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
  line-height: 1.5;
  margin-bottom: 1rem;
  flex-grow: 1;
}

.product-price {
  font-size: 1.4rem;
  font-weight: 700;
  color: #667eea;
  margin-bottom: 1rem;
}

.product-actions {
  display: flex;
  flex-direction: row;
  gap: 0.75rem;
  margin-top: auto;
}

.quantity-input-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.quantity-label {
  font-size: 0.85rem;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.8);
  white-space: nowrap;
}

.quantity-input {
  width: 25px;
  height: 36px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.1);
  color: #ffffff;
  text-align: center;
  font-size: 0.9rem;
  font-weight: 500;
  transition: all 0.3s ease;
}

.quantity-input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
  background: rgba(255, 255, 255, 0.15);
}

.btn-add-cart, .btn-order-now {
  flex: 1;
  height: 36px;
  padding: 0.4rem 0.8rem;
  font-weight: 300;
  border-radius: 12px;
  transition: all 0.3s ease;
  text-transform: uppercase;
  font-size: 0.6rem;
  letter-spacing: 0.5px;
  border: none;
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

.btn-add-cart {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: white;
}

.btn-add-cart:hover {
  background: linear-gradient(135deg, #00f2fe 0%, #4facfe 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
}

.btn-order-now {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-order-now:hover {
  background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

select option {
  color: black;
}

.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  margin: 2rem 0;
}

.empty-icon {
  font-size: 4rem;
  color: rgba(102, 126, 234, 0.5);
  margin-bottom: 1rem;
}

.empty-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: #ffffff;
  margin-bottom: 0.5rem;
}

.empty-text {
  color: rgba(255, 255, 255, 0.7);
  font-size: 1rem;
}

@media (max-width: 768px) {
  .shop-title {
    font-size: 2rem;
  }

  .shop-subtitle {
    font-size: 1.1rem;
  }

  .filter-form {
    flex-direction: column;
    align-items: stretch;
  }

  .filter-select {
    min-width: auto;
  }

  .product-actions {
    flex-direction: column;
  }

  .btn-add-cart, .btn-order-now {
    margin-bottom: 0.5rem;
  }
}
</style>
{% endblock %}

{% block content %}

<!-- SHOP HERO -->
<section class="shop-hero">
  <div class="container">
    <h1 class="shop-title">Discover Our Products</h1>
    <p class="shop-subtitle">Browse through our curated collection of cutting-edge technology and premium electronics</p>
  </div>
</section>

<!-- FILTER SECTION -->
<section class="container">
  <div class="filter-section">
    <h3 class="filter-title text-center">
      <i class="fas fa-filter me-2"></i>Filter Products
    </h3>
    <form method="GET" action="{{ url_for('shop') }}" class="filter-form">
      <select name="category" class="filter-select">
        <option value="">All Categories</option>
        <option value="Smartphones & Accessories" {% if request.args.get('category') == 'Smartphones & Accessories' %}selected{% endif %}>Smartphones & Accessories</option>
        <option value="Computers & Laptops" {% if request.args.get('category') == 'Computers & Laptops' %}selected{% endif %}>Computers & Laptops</option>
        <option value="Gaming" {% if request.args.get('category') == 'Gaming' %}selected{% endif %}>Gaming</option>
        <option value="Audio & Headphones" {% if request.args.get('category') == 'Audio & Headphones' %}selected{% endif %}>Audio & Headphones</option>
      </select>
      <button type="submit" class="filter-button">
        <i class="fas fa-search me-2"></i>Apply Filter
      </button>
    </form>
  </div>
  <div class="container">
    <h2 class="fw-bold text-light mb-4">Our Products</h2>
    {% if products %}
    <div class="row justify-content-center">
      {% for p in products %}
      <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
        <div class="card bg-dark border border-primary shadow-lg h-100 hover-card">
          {% if p.image %}
            <img src="{{ url_for('static', filename='uploads/' + p.image) }} "
                 class="card-img-top rounded-top" alt="{{ p.name }}" style="width: auto; height: 250px;">
          {% else %}
            <img src="{{ url_for('static', filename='img/logo.png') }}"
                 class="card-img-top rounded-top" alt="{{ p.name }}" style="width: auto; height: 250px;">
          {% endif %}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title text-light">{{ p.name }}</h5>
            <p class="text-secondary small flex-grow-1">{{ p.description or "No description available." }}</p>
            <p class="fw-bold text-info mb-3">â‚±{{ "%.2f"|format(p.price) }}</p>
            {% if p.stock_qty > 0 %}
              <p class="text-success small mb-3">In Stock: {{ p.stock_qty }}</p>
            {% else %}
              <p class="text-danger small mb-3">Out of Stock</p>
            {% endif %}

            <div class="product-actions">
             <form action="{{ url_for('place_order', product_id=p.id) }}" method="POST">
    <!-- PAYMENT METHOD -->
    <div class="mb-2">
        <select name="payment_method" class="form-select form-select-sm">
            <option value="Cash on Delivery">Cash on Delivery</option>
            <option value="GCash">GCash</option>
            <option value="PayMaya">PayMaya</option>
        </select>
    </div>

    <!-- QUANTITY + BUTTONS -->
    <div class="input-group">
        <!-- USER CHOOSES QUANTITY -->
        <input type="number"
               name="quantity"
               class="form-control form-control-sm quantity-input"
               value="1" min="1">

        <!-- ADD TO CART BUTTON -->
        <button formaction="{{ url_for('add_to_cart', product_id=p.id) }}"
                formmethod="POST"
                class="btn-add-cart">
            Add to Cart
        </button>

        <!-- BUY NOW -->
        <button class="btn-order-now" type="submit">
            Buy Now
        </button>
    </div>
</form>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      <i class="fas fa-box-open empty-icon"></i>
      <h3 class="empty-title">No Products Found</h3>
      <p class="empty-text">We couldn't find any products matching your criteria. Try adjusting your filters or check back later for new arrivals.</p>
      <a href="{{ url_for('shop') }}" class="btn btn-primary mt-3">
        <i class="fas fa-refresh me-2"></i>View All Products
      </a>
    </div>
    {% endif %}
  </div>
</section>

{% endblock %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const quantityInputs = document.querySelectorAll('.quantity-input');
    quantityInputs.forEach(input => {
        input.addEventListener('input', function() {
            const productId = this.id.replace('qty-', '');
            const cartHidden = document.getElementById('cart-qty-' + productId);
            const orderHidden = document.getElementById('order-qty-' + productId);
            let value = this.value;
            if (value === "" || value < 1) value = 1;
            if (cartHidden) cartHidden.value = value;
            if (orderHidden) orderHidden.value = value;
        });
    });
});
</script>

