{% extends "admin/admin_layout.html" %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='style_admin.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='admin_product.css') }}">
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="text-center mb-5">
    <h2 class="fw-bold text-light">Manage Products</h2>
    <p class="text-secondary">Add, update, or delete products in your inventory.</p>
  </div>

  <!-- Add Product -->
  <div class="card bg-dark p-4 mb-4 shadow-sm">
    <h5 class="text-light mb-3">Add New Product</h5>
    <form method="POST" action="{{ url_for('admin_products') }}" enctype="multipart/form-data" class="row g-3">
      <input type="hidden" name="action" value="add">
      <div class="col-md-6">
        <input name="name" class="form-control" placeholder="Product Name" required>
      </div>
      <div class="col-md-6">
        <input name="description" class="form-control" placeholder="Description">
      </div>
      <div class="col-md-3">
        <input name="price" type="number" step="0.01" class="form-control" placeholder="Price" required>
      </div>
      <div class="col-md-3">
        <input name="stock_qty" type="number" class="form-control" placeholder="Stock" required>
      </div>
      <div class="col-md-3">
        <select name="category" class="form-control">
          <option value="">Select Category</option>
          <option value="Smartphones & Accessories">Smartphones & Accessories</option>
          <option value="Computers & Laptops">Computers & Laptops</option>
          <option value="Gaming">Gaming</option>
          <option value="Audio & Headphones">Audio & Headphones</option>
        </select>
      </div>
      <div class="col-md-3">
        <input type="file" name="image" class="form-control" accept="image/*">
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-success">Add Product</button>
      </div>
    </form>
  </div>

  <!-- Search Form -->
  <div class="card bg-dark p-3 mb-4 shadow-sm">
    <form method="GET" action="{{ url_for('admin_products') }}" class="d-flex">
      <input type="text" name="search" class="form-control me-2" placeholder="Search products by name or description" value="{{ search_query }}">
      <button type="submit" class="btn btn-primary">Search</button>
    </form>
  </div>

  <!-- Product Grid -->
  <div class="row justify-content-center">
    {% for p in products %}
    <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
      <div class="card bg-dark border border-primary shadow-lg h-100 hover-card">
        {% if p.image %}
          <img src="{{ url_for('static', filename='uploads/' + p.image) }}" 
               class="card-img-top rounded-top" alt="{{ p.name }}" style="width: auto; height: 250px;">
        {% else %}
          <img src="{{ url_for('static', filename='img/logo.png') }}" 
               class="card-img-top rounded-top" alt="{{ p.name }}" style="width: auto; height: 250px;">
        {% endif %}
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-light">{{ p.name }}</h5>
          <p class="text-secondary small flex-grow-1">{{ p.description or "No description available." }}</p>
          <p class="fw-bold text-info mb-2">â‚±{{ "%.2f"|format(p.price) }}</p>
          <p class="text-secondary small mb-2">Stock: {{ p.stock_qty }}</p>
          <p class="text-secondary small mb-3">Category: {{ p.category or "N/A" }}</p>
          <div class="d-flex gap-2">
            <a href="{{ url_for('admin_products', id=p.id) }}" class="btn btn-warning btn-sm w-100">Edit</a>
            <form method="POST" action="{{ url_for('admin_products') }}" style="flex: 1;">
              <input type="hidden" name="_method" value="DELETE">
              <input type="hidden" name="delete_id" value="{{ p.id }}">
              <button type="submit" class="btn btn-danger btn-sm w-100" onclick="return confirm('Are you sure you want to delete this product?')">Delete</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}