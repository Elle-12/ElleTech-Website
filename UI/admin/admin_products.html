{% extends "admin/admin_layout.html" %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='style_admin.css') }}">
<style>
.hover-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="text-center mb-5">
    <h2 class="fw-bold text-light">Manage Products</h2>
    <p class="text-secondary">Add, update, or delete products in your inventory.</p>
  </div>

  <!-- Add/Edit Product Form -->
  <div class="card bg-dark p-4 mb-4 shadow-sm">
    <h5 class="text-light mb-3">
      {% if product %}Edit Product{% else %}Add New Product{% endif %}
    </h5>
    <form method="POST" action="{{ url_for('admin_products', product_id=product.id if product else None) }}" enctype="multipart/form-data" class="row g-3">
      {% if product %}
        <input type="hidden" name="current_image" value="{{ product.image }}">
      {% else %}
        <input type="hidden" name="action" value="add">
      {% endif %}
      
      <div class="col-md-6">
        <input name="name" class="form-control" placeholder="Product Name" 
               value="{{ product.name if product else '' }}" required>
      </div>
      <div class="col-md-6">
        <input name="description" class="form-control" placeholder="Description"
               value="{{ product.description if product else '' }}">
      </div>
      <div class="col-md-3">
        <input name="price" type="number" step="0.01" class="form-control" placeholder="Price" 
               value="{{ product.price if product else '' }}" required>
      </div>
      <div class="col-md-3">
        <input name="stock_qty" type="number" class="form-control" placeholder="Stock" 
               value="{{ product.stock_qty if product else '' }}" required>
      </div>
      <div class="col-md-3">
        <select name="category" class="form-control">
          <option value="">Select Category</option>
          <option value="Smartphones & Accessories" {% if product and product.category == 'Smartphones & Accessories' %}selected{% endif %}>Smartphones & Accessories</option>
          <option value="Computers & Laptops" {% if product and product.category == 'Computers & Laptops' %}selected{% endif %}>Computers & Laptops</option>
          <option value="Gaming" {% if product and product.category == 'Gaming' %}selected{% endif %}>Gaming</option>
          <option value="Audio & Headphones" {% if product and product.category == 'Audio & Headphones' %}selected{% endif %}>Audio & Headphones</option>
        </select>
      </div>
      <div class="col-md-3">
        <input type="file" name="image" class="form-control" accept="image/*">
        {% if product and product.image %}
          <small class="text-muted">Current: {{ product.image }}</small>
        {% endif %}
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-success">
          {% if product %}Update Product{% else %}Add Product{% endif %}
        </button>
        {% if product %}
          <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">Cancel</a>
        {% endif %}
      </div>
    </form>
  </div>

  <!-- Search Form -->
  <div class="card bg-dark p-3 mb-4 shadow-sm">
    <form method="GET" action="{{ url_for('admin_products') }}" class="d-flex">
      <input type="text" name="search" class="form-control me-2" placeholder="Search products by name or description" value="{{ search_query }}">
      <button type="submit" class="btn btn-primary">Search</button>
      {% if search_query %}
        <a href="{{ url_for('admin_products') }}" class="btn btn-secondary ms-2">Clear</a>
      {% endif %}
    </form>
  </div>

  <!-- Product Grid -->
  <div class="row justify-content-center">
    {% for p in products %}
    <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
      <div class="card bg-dark border border-primary shadow-lg h-100 hover-card">
        {% if p.image %}
          <img src="{{ url_for('static', filename='uploads/' + p.image) }}" 
               class="card-img-top rounded-top" alt="{{ p.name }}" style="height: 250px; object-fit: cover;">
        {% else %}
          <img src="{{ url_for('static', filename='img/logo.png') }}" 
               class="card-img-top rounded-top" alt="{{ p.name }}" style="height: 250px; object-fit: cover;">
        {% endif %}
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-light">{{ p.name }}</h5>
          <p class="text-secondary small flex-grow-1">{{ p.description or "No description available." }}</p>
          <p class="fw-bold text-info mb-2">â‚±{{ "%.2f"|format(p.price) }}</p>
          <p class="text-secondary small mb-2">Stock: {{ p.stock_qty }}</p>
          <p class="text-secondary small mb-3">Category: {{ p.category or "N/A" }}</p>
          <div class="d-flex gap-2">
            <a href="{{ url_for('admin_products', product_id=p.id) }}" class="btn btn-warning btn-sm w-100">Edit</a>
            <form method="POST" action="{{ url_for('admin_products') }}" style="flex: 1;">
              <input type="hidden" name="_method" value="DELETE">
              <input type="hidden" name="delete_id" value="{{ p.id }}">
              <button type="submit" class="btn btn-danger btn-sm w-100" onclick="return confirm('Are you sure you want to delete this product?')">Delete</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}