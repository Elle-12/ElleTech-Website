{% extends "admin/admin_layout.html" %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='style_admin.css') }}">
<style>
.hover-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}
.status-badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="text-center mb-5">
    <h2 class="fw-bold text-light">Manage Orders</h2>
    <p class="text-secondary">View and update order statuses.</p>
  </div>

  <!-- Orders Grid -->
  <div class="row justify-content-center">
    {% for order in orders %}
    <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
      <div class="card bg-dark border border-primary shadow-lg h-100 hover-card">
        {% if order.image %}
          <img src="{{ url_for('static', filename='uploads/' + order.image) }}" 
               class="card-img-top rounded-top" alt="{{ order.product_name }}" style="height: 250px; object-fit: cover;">
        {% else %}
          <img src="{{ url_for('static', filename='img/logo.png') }}" 
               class="card-img-top rounded-top" alt="{{ order.product_name }}" style="height: 250px; object-fit: cover;">
        {% endif %}
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-light">{{ order.product_name }}</h5>
          <p class="text-secondary small">Order ID: {{ order.id }}</p>
          <p class="text-secondary small">User: {{ order.user_full_name }} ({{ order.username }})</p>
          <p class="text-secondary small">Address: {{ order.user_address or "N/A" }}</p>
          <p class="text-secondary small">Quantity: {{ order.quantity }}</p>
          <p class="fw-bold text-info mb-2">â‚±{{ "%.2f"|format(order.total_price) }}</p>
          
          <!-- Status Badges -->
          <div class="d-flex gap-1 mb-2">
            <span class="badge {% if order.payment_status == 'paid' %}bg-success{% else %}bg-warning{% endif %} status-badge">
              Payment: {{ order.payment_status }}
            </span>
            <span class="badge {% if order.status == 'delivered' %}bg-success{% elif order.status == 'cancelled' %}bg-danger{% else %}bg-info{% endif %} status-badge">
              Status: {{ order.status }}
            </span>
          </div>
          
          <p class="text-secondary small mb-2">Payment: {{ order.payment_method or 'N/A' }}</p>
          <p class="text-secondary small mb-3">Date: {{ order.order_date.strftime('%Y-%m-%d %H:%M') }}</p>
          
          <!-- Update Status Form -->
          <form method="POST" action="{{ url_for('admin_orders') }}">
            <input type="hidden" name="order_id" value="{{ order.id }}">
            <div class="d-flex gap-2">
              <select name="status" class="form-select form-select-sm">
                <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="paid" {% if order.status == 'paid' %}selected{% endif %}>Paid</option>
                <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>Shipped</option>
                <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Delivered</option>
                <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
              </select>
              <button type="submit" class="btn btn-warning btn-sm">Update</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12 text-center">
      <div class="card bg-dark p-5">
        <h5 class="text-light">No Orders Found</h5>
        <p class="text-secondary">There are no orders in the system yet.</p>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}